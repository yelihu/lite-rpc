# 报文协议设计

1. 设计报文的目标是什么？*紧凑*
2. http的无状态是什么？*必须在一个连接里面完成通讯*
3. lite-rpc协议结构是什么？
4. 设计通信协议，Header有哪些必须考虑的点？
5. body需要有哪些必须考虑的点?
6. 什么是粘包和拆包？
7. header需要加入什么字段信息可以帮助拆包和粘包？
8. 拆包和粘包还有什么解决方案？*请求长度定长（补0..）、标注请求大小（length字段）*
9. body为什么要区分response和request类型？

## 报文协议设计的作用

自定义报文协议的好处有什么？

1. 报文大小和格式可以自由控制
2. 根据业务场景需要设置报文字段、选择序列化方式，可以因地制宜减少开销。
3. 设计补充和删减字段用来支持可扩展性，自由决定协议是否是轻量级、是否需要支持安全、是否需要压缩和认证等支持、是否需要支持版本升级。
4. 报文可以携带异常等信息，支持日常的调试。

为了减少开销，可以将报文设计的紧凑一些：

1. 编码方式可以为二进制，借助Protocol Buffers可以方便的操作和传输
2. 谨慎考虑字段设计，避免冗余、无关字段和默认值的存在。
3. 根据算法进行数据压缩
4. 常见字符串可以用数字ID维护一个映射，减少字符串的传输
5. 多个小请求可以支持合并为一个请求，实现批量传输
6. 重复字段抽取为一个“结构体”，减少重复字段传输。



